SET default_storage_engine = InnoDB;

DROP TABLE IF EXISTS PEDIDO;
DROP TABLE IF EXISTS VIAGEM;
DROP TABLE IF EXISTS CLIENTE;
DROP TABLE IF EXISTS VEICULO;
DROP TABLE IF EXISTS MOTORISTA;
DROP TABLE IF EXISTS PESSOA_FISICA;
DROP TABLE IF EXISTS PESSOA_JURIDICA;



CREATE TABLE PESSOA_JURIDICA (
    CNPJ VARCHAR(14) PRIMARY KEY
);

CREATE TABLE PESSOA_FISICA (
    CPF VARCHAR(11) PRIMARY KEY
);

CREATE TABLE MOTORISTA (
    CNH VARCHAR(20) PRIMARY KEY,
    nome VARCHAR(100) NOT NULL
);

CREATE TABLE VEICULO (
    Placa VARCHAR(10) PRIMARY KEY,
    capacidade DECIMAL(10, 2) NOT NULL 
);


CREATE TABLE CLIENTE (
    -- Correção: Substitui SERIAL por INT AUTO_INCREMENT PRIMARY KEY (sintaxe MySQL)
    id_cliente INT AUTO_INCREMENT PRIMARY KEY, 
    nome VARCHAR(100) NOT NULL,
    endereco VARCHAR(255),
    
    CNPJ VARCHAR(14) UNIQUE,
    CPF VARCHAR(11) UNIQUE,

    
    FOREIGN KEY (CNPJ) REFERENCES PESSOA_JURIDICA(CNPJ),
    FOREIGN KEY (CPF) REFERENCES PESSOA_FISICA(CPF)
);


CREATE TABLE VIAGEM (
    id_viagem INT AUTO_INCREMENT PRIMARY KEY,
    saida DATETIME NOT NULL,
    chegada DATETIME NULL, -- Correção para o erro 'Invalid default value'
    
    Placa VARCHAR(10) NOT NULL,
    CNH VARCHAR(20) NOT NULL,
    
    FOREIGN KEY (Placa) REFERENCES VEICULO(Placa),
    FOREIGN KEY (CNH) REFERENCES MOTORISTA(CNH)
);


CREATE TABLE PEDIDO (
    id_pedido INT AUTO_INCREMENT PRIMARY KEY,
    id_cliente INT NOT NULL,
    descricao TEXT,
    peso DECIMAL(10, 2) NOT NULL,
    valor DECIMAL(10, 2) NOT NULL,
    origem VARCHAR(255) NOT NULL,
    destino VARCHAR(255) NOT NULL,
    
    id_viagem INT NULL, 
    
    FOREIGN KEY (id_cliente) REFERENCES CLIENTE(id_cliente),
    FOREIGN KEY (id_viagem) REFERENCES VIAGEM(id_viagem)
);
